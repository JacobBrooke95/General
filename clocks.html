<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jacob Brooke - Clocks</title>
<link rel="stylesheet" href="styles.css">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600&family=Space+Mono:wght@400;700&family=Playfair+Display:wght@300;400;500&family=DM+Serif+Display&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg) !important;
    color: var(--text);
    transition: background 0.6s ease, color 0.6s ease;
    -webkit-font-smoothing: antialiased;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Keep navbar above ambient glow */
  .navbar { position: relative; z-index: 10; }

  /* ===== THEME VARIABLES (Site light = default) ===== */
  :root {
    --bg: #fdf6e3;
    --surface: #ffffff;
    --surface2: #f5e6d3;
    --border: rgba(92, 74, 61, 0.1);
    --text: #2d3436;
    --text2: #636e72;
    --text3: #a09890;
    --accent: #e07a5f;
    --accent-glow: rgba(224, 122, 95, 0.2);
    --hand-h: #5c4a3d;
    --hand-m: #3a302a;
    --hand-s: #e07a5f;
    --tick-major: #8a7a6a;
    --tick-minor: #e0d4c8;
    --num-fill: #7a6a5a;
    --num-fill-bright: #5c4a3d;
    --center-outer: #e0d4c8;
    --ambient-color: rgba(224, 122, 95, 0.06);
    --font: Arial, -apple-system, system-ui, sans-serif;
    --font-time: Arial, sans-serif;
    --time-weight: 300;
    --num-size: 18px;
    --num-24-size: 12.5px;
    --num-24-q-size: 15px;
  }

  .ambient {
    position: fixed;
    top: -200px;
    left: 50%;
    transform: translateX(-50%);
    width: 700px;
    height: 500px;
    background: radial-gradient(ellipse, var(--ambient-color) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
    transition: background 0.8s ease;
  }

  .clock-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: calc(100vh - 56px);
    position: relative;
  }

  .app {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
    font-family: var(--font);
    max-width: 560px;
    width: 100%;
    padding: 20px;
  }

  /* ===== CONTROLS BAR ===== */
  .controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin-bottom: 36px;
    flex-wrap: wrap;
  }

  .pill-group {
    display: flex;
    gap: 2px;
    padding: 3px;
    background: var(--surface);
    border-radius: 10px;
    border: 1px solid var(--border);
    transition: background 0.4s, border-color 0.4s;
  }

  .pill-btn {
    padding: 7px 14px;
    background: none;
    border: none;
    color: var(--text3);
    font-family: var(--font);
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 0.8px;
    text-transform: uppercase;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.25s ease;
    white-space: nowrap;
  }

  .pill-btn:hover { color: var(--text2); }

  .pill-btn.active {
    background: var(--surface2);
    color: var(--text);
    box-shadow: 0 1px 6px rgba(0,0,0,0.25);
  }

  .mode-btn {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--text3);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    transition: all 0.3s ease;
    flex-shrink: 0;
  }

  .mode-btn:hover { color: var(--text2); border-color: rgba(0,0,0,0.08); }

  /* ===== ANALOG CLOCK ===== */
  .analog-clock {
    width: 380px;
    height: 380px;
    max-width: 100%;
    margin-bottom: 44px;
    transition: filter 0.4s;
  }

  .analog-clock svg { width: 100%; height: 100%; }

  .clock-face { fill: var(--surface); stroke: var(--border); stroke-width: 1; transition: fill 0.4s, stroke 0.4s; }
  .clock-face-inner { fill: none; stroke: var(--border); stroke-width: 0.5; transition: stroke 0.4s; }

  .tick-major { stroke: var(--tick-major); stroke-width: 2; stroke-linecap: round; transition: stroke 0.4s; }
  .tick-minor { stroke: var(--tick-minor); stroke-width: 1; stroke-linecap: round; transition: stroke 0.4s; }

  .hour-num {
    fill: var(--num-fill);
    font-size: var(--num-size);
    font-weight: 400;
    text-anchor: middle;
    dominant-baseline: central;
    font-family: var(--font);
    transition: fill 0.4s;
  }

  .hour-num-24 {
    fill: var(--num-fill);
    font-size: var(--num-24-size);
    font-weight: 400;
    text-anchor: middle;
    dominant-baseline: central;
    font-family: var(--font);
    transition: fill 0.4s;
  }

  .hour-num-24.quarter { font-size: var(--num-24-q-size); fill: var(--num-fill-bright); }

  .hand-hour { stroke: var(--hand-h); stroke-width: 4.5; stroke-linecap: round; transition: stroke 0.4s; }
  .hand-minute { stroke: var(--hand-m); stroke-width: 2.5; stroke-linecap: round; transition: stroke 0.4s; }
  .hand-second { stroke: var(--hand-s); stroke-width: 1.5; stroke-linecap: round; filter: drop-shadow(0 0 6px var(--accent-glow)); transition: stroke 0.4s, filter 0.4s; }

  .center-outer { fill: var(--center-outer); transition: fill 0.4s; }
  .center-inner { fill: var(--accent); transition: fill 0.4s; }

  /* ===== DIGITAL READOUT ===== */
  .main-time {
    font-family: var(--font-time);
    font-size: 76px;
    font-weight: var(--time-weight);
    letter-spacing: 2px;
    font-variant-numeric: tabular-nums;
    line-height: 1;
    margin-bottom: 6px;
    transition: color 0.4s, font-family 0.3s;
  }

  .main-time .period {
    font-size: 22px;
    font-weight: 400;
    color: var(--text3);
    margin-left: 6px;
    letter-spacing: 1px;
  }

  .main-time .sec {
    font-size: 28px;
    color: var(--accent);
    font-weight: 300;
    vertical-align: super;
    margin-left: 2px;
    transition: color 0.4s;
  }

  .main-time .colon { transition: opacity 0.15s; }
  .main-time .colon.dim { opacity: 0.2; }

  .main-date {
    font-size: 15px;
    color: var(--text3);
    letter-spacing: 2.5px;
    text-transform: uppercase;
    font-weight: 400;
    margin-bottom: 4px;
    transition: color 0.4s;
  }

  .main-tz {
    font-size: 11px;
    color: var(--text3);
    letter-spacing: 1.5px;
    opacity: 0.5;
    transition: color 0.4s;
  }

  /* ===== ORBITAL RING (Year view) ===== */
  .orbital-clock {
    width: 420px;
    height: 420px;
    max-width: 100%;
    margin-bottom: 36px;
    transition: filter 0.4s;
  }
  .orbital-clock svg { width: 100%; height: 100%; }

  .season-arc { fill: none; stroke-width: 18; opacity: 0.12; transition: stroke 0.4s, opacity 0.4s; }
  .season-spring { stroke: #44cc66; }
  .season-summer { stroke: #ffaa22; }
  .season-autumn { stroke: #dd5533; }
  .season-winter { stroke: #4488dd; }

  .ring-bg { fill: none; stroke: var(--surface2); stroke-width: 22; transition: stroke 0.4s; }
  .ring-border-outer, .ring-border-inner { fill: none; stroke: var(--border); stroke-width: 0.8; transition: stroke 0.4s; }

  .month-tick { stroke: var(--tick-major); stroke-width: 2; stroke-linecap: round; transition: stroke 0.4s; }
  .week-tick { stroke: var(--tick-minor); stroke-width: 0.8; stroke-linecap: round; transition: stroke 0.4s; }

  .month-label {
    fill: var(--num-fill);
    font-size: 11px;
    font-weight: 400;
    text-anchor: middle;
    dominant-baseline: central;
    font-family: var(--font);
    letter-spacing: 0.5px;
    transition: fill 0.4s;
  }
  .month-label.current-month { fill: var(--text); font-weight: 500; }

  .marker-dot { fill: var(--text3); transition: fill 0.4s; }
  .marker-label {
    fill: var(--text3);
    font-size: 7px;
    text-anchor: middle;
    dominant-baseline: central;
    font-family: var(--font);
    letter-spacing: 0.6px;
    text-transform: uppercase;
    transition: fill 0.4s;
  }

  .year-hand { stroke: var(--accent); stroke-width: 2.5; stroke-linecap: round; filter: drop-shadow(0 0 6px var(--accent-glow)); transition: stroke 0.4s, filter 0.4s; }
  .year-dot { fill: var(--accent); filter: drop-shadow(0 0 8px var(--accent-glow)); transition: fill 0.4s, filter 0.4s; }
  .year-dot-halo { fill: var(--accent); opacity: 0.15; transition: fill 0.4s; }

  .daylight-bar { stroke-linecap: butt; opacity: 0.55; transition: stroke 0.4s, opacity 0.4s; }
  .daylight-bar.past { opacity: 0.25; }

  .trail-arc { fill: none; stroke: var(--accent); stroke-width: 4; opacity: 0.25; stroke-linecap: round; transition: stroke 0.4s; }

  /* ===== YEAR STATS ===== */
  .stats {
    display: flex;
    gap: 40px;
    margin-bottom: 10px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }

  .stat-value {
    font-family: var(--font-time);
    font-size: 36px;
    font-weight: var(--time-weight);
    color: var(--text);
    line-height: 1;
    font-variant-numeric: tabular-nums;
    transition: color 0.4s, font-family 0.3s;
  }

  .stat-value .unit {
    font-size: 16px;
    color: var(--accent);
    font-weight: 400;
    margin-left: 2px;
    transition: color 0.4s;
  }

  .stat-label {
    font-size: 10px;
    color: var(--text3);
    letter-spacing: 2px;
    text-transform: uppercase;
    transition: color 0.4s;
  }

  .date-line {
    font-family: var(--font);
    font-size: 15px;
    color: var(--text3);
    letter-spacing: 2.5px;
    text-transform: uppercase;
    font-weight: 400;
    margin-bottom: 4px;
    transition: color 0.4s;
  }

  .sub-line {
    font-size: 11px;
    color: var(--text3);
    letter-spacing: 1.5px;
    opacity: 0.5;
    transition: color 0.4s;
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 768px) {
    .analog-clock { width: 300px; height: 300px; }
    .orbital-clock { width: 340px; height: 340px; }
    .main-time { font-size: 56px; }
    .stat-value { font-size: 28px; }
    .stats { gap: 24px; }
    .controls { gap: 8px; }
  }

  @media (max-width: 480px) {
    .analog-clock { width: 260px; height: 260px; }
    .orbital-clock { width: 280px; height: 280px; }
    .main-time { font-size: 44px; }
    .clock-wrapper { min-height: auto; padding: 20px 0; }
  }
</style>
</head>
<body>

<nav class="navbar">
    <div class="container">
        <h1 class="logo">Jacob Brooke</h1>
        <ul class="nav-links">
            <li><a href="about.html">About</a></li>
            <li><a href="now.html">Now</a></li>
            <li><a href="reads.html">Reads</a></li>
            <li><a href="year_in_review_2025.html">2025 Running</a></li>
            <li><a href="clocks.html" class="active">Clocks</a></li>
            <li><a href="claude-models.html">Claude Guide</a></li>
        </ul>
    </div>
</nav>

<div class="ambient" id="ambient"></div>

<div class="clock-wrapper">
  <div class="app">
    <!-- Controls -->
    <div class="controls">
      <div class="pill-group" id="view-group">
        <button class="pill-btn active" data-view="clock">Clock</button>
        <button class="pill-btn" data-view="year">Year</button>
      </div>
      <div class="pill-group" id="format-group">
        <button class="pill-btn" data-fmt="12">12H</button>
        <button class="pill-btn active" data-fmt="24">24H</button>
      </div>
      <div class="pill-group" id="style-group">
        <button class="pill-btn active" data-style="site">Site</button>
        <button class="pill-btn" data-style="main">Main</button>
        <button class="pill-btn" data-style="retro">Retro</button>
        <button class="pill-btn" data-style="warm">Warm</button>
        <button class="pill-btn" data-style="classic">Classic</button>
      </div>
      <button class="mode-btn" id="mode-toggle" title="Toggle light/dark">&#9728;</button>
    </div>

    <!-- ===== CLOCK VIEW ===== -->
    <div id="clock-view">
      <div class="analog-clock">
        <svg viewBox="0 0 300 300">
          <circle cx="150" cy="150" r="146" class="clock-face"/>
          <circle cx="150" cy="150" r="128" class="clock-face-inner"/>
          <g id="ticks"></g>
          <g id="numbers"></g>
          <line id="hand-h" class="hand-hour" x1="150" y1="150" x2="150" y2="78"/>
          <line id="hand-m" class="hand-minute" x1="150" y1="150" x2="150" y2="48"/>
          <line id="hand-s" class="hand-second" x1="150" y1="168" x2="150" y2="40"/>
          <circle cx="150" cy="150" r="5.5" class="center-outer"/>
          <circle cx="150" cy="150" r="2.8" class="center-inner"/>
        </svg>
      </div>
      <div class="main-time" id="main-time"></div>
      <div class="main-date" id="main-date"></div>
      <div class="main-tz" id="main-tz"></div>
    </div>

    <!-- ===== YEAR VIEW ===== -->
    <div id="year-view" style="display:none">
      <div class="orbital-clock">
        <svg viewBox="0 0 400 400" id="orbit-svg">
          <defs>
            <filter id="glow">
              <feGaussianBlur stdDeviation="3" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>
          <g id="seasons"></g>
          <circle cx="200" cy="200" r="155" class="ring-bg"/>
          <circle cx="200" cy="200" r="166" class="ring-border-outer"/>
          <circle cx="200" cy="200" r="144" class="ring-border-inner"/>
          <g id="daylight-bars"></g>
          <g id="year-ticks"></g>
          <g id="labels"></g>
          <g id="markers"></g>
          <path id="trail-arc" class="trail-arc" d=""/>
          <line id="year-hand" class="year-hand" x1="200" y1="200" x2="200" y2="200"/>
          <circle id="dot-halo" class="year-dot-halo" cx="200" cy="40" r="10"/>
          <circle id="dot-main" class="year-dot" cx="200" cy="40" r="5"/>
          <circle cx="200" cy="200" r="30" class="center-outer"/>
          <circle cx="200" cy="200" r="26" class="center-inner" style="fill: var(--surface); transition: fill 0.4s;"/>
          <text id="center-year" x="200" y="200" text-anchor="middle" dominant-baseline="central"
                style="fill: var(--text); font-size: 14px; font-weight: 500; font-family: var(--font); letter-spacing: 1px; transition: fill 0.4s;"></text>
        </svg>
      </div>

      <div class="stats">
        <div class="stat">
          <div class="stat-value" id="stat-pct">0<span class="unit">%</span></div>
          <div class="stat-label">Year Complete</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="stat-day">0</div>
          <div class="stat-label">Day of Year</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="stat-remain">0</div>
          <div class="stat-label">Days Remaining</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="stat-light">0<span class="unit">h</span></div>
          <div class="stat-label">Daylight Today</div>
        </div>
      </div>

      <div class="date-line" id="date-line"></div>
      <div class="sub-line" id="season-line"></div>
    </div>
  </div>
</div>

<script>
// ===== SELECTORS =====
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);

// ===== STATE =====
let currentView = 'clock';
let is24h = true;
let currentStyle = 'site';
let isDark = false; // Site theme starts light

// ===== THEMES =====
const themes = {
  site: {
    dark: {
      bg:'#1a1410', surface:'#261e16', surface2:'#332a20', border:'rgba(224,122,95,0.08)',
      text:'#f0e6d8', text2:'#a89080', text3:'#6a5a48',
      accent:'#e07a5f', accentGlow:'rgba(224,122,95,0.3)',
      handH:'#c0b0a0', handM:'#d8c8b8', handS:'#e07a5f',
      tickMajor:'#7a6a58', tickMinor:'#332a20',
      numFill:'#8a7a68', numBright:'#b0a090', centerOuter:'#332a20',
      ambient:'rgba(224,122,95,0.06)',
      font:"Arial, -apple-system, system-ui, sans-serif",
      fontTime:"Arial, sans-serif", timeWeight:'300',
    },
    light: {
      bg:'#fdf6e3', surface:'#ffffff', surface2:'#f5e6d3', border:'rgba(92,74,61,0.1)',
      text:'#2d3436', text2:'#636e72', text3:'#a09890',
      accent:'#e07a5f', accentGlow:'rgba(224,122,95,0.2)',
      handH:'#5c4a3d', handM:'#3a302a', handS:'#e07a5f',
      tickMajor:'#8a7a6a', tickMinor:'#e0d4c8',
      numFill:'#7a6a5a', numBright:'#5c4a3d', centerOuter:'#e0d4c8',
      ambient:'rgba(224,122,95,0.06)',
      font:"Arial, -apple-system, system-ui, sans-serif",
      fontTime:"Arial, sans-serif", timeWeight:'300',
    }
  },
  main: {
    dark: {
      bg:'#0a0a0f', surface:'#12121a', surface2:'#1a1a25', border:'rgba(255,255,255,0.03)',
      text:'#eeeef2', text2:'#8888a0', text3:'#55556a',
      accent:'#ff4f4f', accentGlow:'rgba(255,79,79,0.3)',
      handH:'#c0c0cc', handM:'#dddde8', handS:'#ff4f4f',
      tickMajor:'#666680', tickMinor:'#2a2a38',
      numFill:'#77778a', numBright:'#9999aa', centerOuter:'#2a2a38',
      ambient:'rgba(255,79,79,0.06)',
      font:"'Inter', -apple-system, system-ui, sans-serif",
      fontTime:"'Inter', sans-serif", timeWeight:'200',
    },
    light: {
      bg:'#f4f4f8', surface:'#ffffff', surface2:'#eeeef3', border:'rgba(0,0,0,0.06)',
      text:'#1a1a2e', text2:'#666688', text3:'#999aaf',
      accent:'#e03030', accentGlow:'rgba(224,48,48,0.2)',
      handH:'#333348', handM:'#222238', handS:'#e03030',
      tickMajor:'#888898', tickMinor:'#ccccda',
      numFill:'#777790', numBright:'#555568', centerOuter:'#ccccda',
      ambient:'rgba(224,48,48,0.05)',
      font:"'Inter', -apple-system, system-ui, sans-serif",
      fontTime:"'Inter', sans-serif", timeWeight:'200',
    }
  },
  retro: {
    dark: {
      bg:'#080c08', surface:'#0e140e', surface2:'#141e14', border:'rgba(50,255,50,0.06)',
      text:'#33ff66', text2:'#22aa44', text3:'#116622',
      accent:'#33ff66', accentGlow:'rgba(50,255,100,0.3)',
      handH:'#22cc44', handM:'#28ee55', handS:'#33ff66',
      tickMajor:'#22aa44', tickMinor:'#0e4418',
      numFill:'#22aa44', numBright:'#33ff66', centerOuter:'#0e4418',
      ambient:'rgba(50,255,100,0.05)',
      font:"'Space Mono', monospace",
      fontTime:"'Space Mono', monospace", timeWeight:'400',
    },
    light: {
      bg:'#eaf5ea', surface:'#f8fdf8', surface2:'#e0efe0', border:'rgba(0,80,0,0.08)',
      text:'#0a3a0a', text2:'#336633', text3:'#88aa88',
      accent:'#007722', accentGlow:'rgba(0,120,34,0.15)',
      handH:'#225522', handM:'#1a441a', handS:'#007722',
      tickMajor:'#558855', tickMinor:'#bbddbb',
      numFill:'#447744', numBright:'#225522', centerOuter:'#bbddbb',
      ambient:'rgba(0,120,34,0.04)',
      font:"'Space Mono', monospace",
      fontTime:"'Space Mono', monospace", timeWeight:'400',
    }
  },
  warm: {
    dark: {
      bg:'#110c06', surface:'#1a1208', surface2:'#231a0e', border:'rgba(255,180,80,0.06)',
      text:'#f0dcc0', text2:'#aa8855', text3:'#665533',
      accent:'#e8942a', accentGlow:'rgba(232,148,42,0.3)',
      handH:'#ccaa77', handM:'#e0c898', handS:'#e8942a',
      tickMajor:'#8a7050', tickMinor:'#3a2e1e',
      numFill:'#8a7050', numBright:'#bba070', centerOuter:'#3a2e1e',
      ambient:'rgba(232,148,42,0.06)',
      font:"'Playfair Display', Georgia, serif",
      fontTime:"'Playfair Display', serif", timeWeight:'300',
    },
    light: {
      bg:'#faf5ec', surface:'#fff9f0', surface2:'#f0e8d8', border:'rgba(120,80,20,0.08)',
      text:'#3a2810', text2:'#886640', text3:'#bbaa88',
      accent:'#c07020', accentGlow:'rgba(192,112,32,0.18)',
      handH:'#6a5030', handM:'#4a3820', handS:'#c07020',
      tickMajor:'#9a8868', tickMinor:'#ddd0bb',
      numFill:'#7a6848', numBright:'#5a4828', centerOuter:'#ddd0bb',
      ambient:'rgba(192,112,32,0.04)',
      font:"'Playfair Display', Georgia, serif",
      fontTime:"'Playfair Display', serif", timeWeight:'300',
    }
  },
  classic: {
    dark: {
      bg:'#080a14', surface:'#101420', surface2:'#181e2e', border:'rgba(200,180,100,0.06)',
      text:'#d8d0c0', text2:'#8888a0', text3:'#555570',
      accent:'#c8a050', accentGlow:'rgba(200,160,80,0.25)',
      handH:'#9898b0', handM:'#b0b0c8', handS:'#c8a050',
      tickMajor:'#6a6a88', tickMinor:'#2a2a40',
      numFill:'#707088', numBright:'#9898b0', centerOuter:'#2a2a40',
      ambient:'rgba(200,160,80,0.05)',
      font:"'DM Serif Display', Georgia, serif",
      fontTime:"'DM Serif Display', serif", timeWeight:'400',
    },
    light: {
      bg:'#f0f0f8', surface:'#fafafe', surface2:'#e8e8f2', border:'rgba(40,40,80,0.07)',
      text:'#1a1a30', text2:'#6a6a88', text3:'#9898b0',
      accent:'#8a6820', accentGlow:'rgba(138,104,32,0.15)',
      handH:'#3a3a58', handM:'#282840', handS:'#8a6820',
      tickMajor:'#787899', tickMinor:'#ccccdd',
      numFill:'#606078', numBright:'#3a3a58', centerOuter:'#ccccdd',
      ambient:'rgba(138,104,32,0.04)',
      font:"'DM Serif Display', Georgia, serif",
      fontTime:"'DM Serif Display', serif", timeWeight:'400',
    }
  }
};

// ===== APPLY THEME =====
function applyTheme() {
  const t = themes[currentStyle][isDark ? 'dark' : 'light'];
  const r = document.documentElement.style;
  r.setProperty('--bg', t.bg);
  r.setProperty('--surface', t.surface);
  r.setProperty('--surface2', t.surface2);
  r.setProperty('--border', t.border);
  r.setProperty('--text', t.text);
  r.setProperty('--text2', t.text2);
  r.setProperty('--text3', t.text3);
  r.setProperty('--accent', t.accent);
  r.setProperty('--accent-glow', t.accentGlow);
  r.setProperty('--hand-h', t.handH);
  r.setProperty('--hand-m', t.handM);
  r.setProperty('--hand-s', t.handS);
  r.setProperty('--tick-major', t.tickMajor);
  r.setProperty('--tick-minor', t.tickMinor);
  r.setProperty('--num-fill', t.numFill);
  r.setProperty('--num-fill-bright', t.numBright);
  r.setProperty('--center-outer', t.centerOuter);
  r.setProperty('--ambient-color', t.ambient);
  r.setProperty('--font', t.font);
  r.setProperty('--font-time', t.fontTime);
  r.setProperty('--time-weight', t.timeWeight);

  $('#mode-toggle').innerHTML = isDark ? '&#9790;' : '&#9728;';

  // Rebuild visuals with new font/colors
  buildClockFace(is24h);
  if (currentView === 'year') buildRing();
}

// ===== VIEW TOGGLE =====
$$('#view-group .pill-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    $$('#view-group .pill-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentView = btn.dataset.view;
    $('#clock-view').style.display = currentView === 'clock' ? '' : 'none';
    $('#year-view').style.display = currentView === 'year' ? '' : 'none';
    $('#format-group').style.display = currentView === 'clock' ? 'flex' : 'none';
    if (currentView === 'year') buildRing();
  });
});

// ===== FORMAT TOGGLE =====
$$('#format-group .pill-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    $$('#format-group .pill-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    is24h = btn.dataset.fmt === '24';
    buildClockFace(is24h);
  });
});

// ===== STYLE TOGGLE =====
$$('#style-group .pill-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    $$('#style-group .pill-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentStyle = btn.dataset.style;
    applyTheme();
  });
});

// ===== LIGHT/DARK TOGGLE =====
$('#mode-toggle').addEventListener('click', () => {
  isDark = !isDark;
  applyTheme();
});

// =====================================================================
//  CLOCK VIEW
// =====================================================================
const CLOCK_CX = 150, CLOCK_CY = 150;

function buildClockFace(mode24) {
  const tG = document.getElementById('ticks');
  const nG = document.getElementById('numbers');
  tG.innerHTML = '';
  nG.innerHTML = '';

  const fontFamily = themes[currentStyle][isDark ? 'dark' : 'light'].font;

  if (!mode24) {
    for (let i = 0; i < 60; i++) {
      const a = (i * 6 - 90) * Math.PI / 180;
      const major = i % 5 === 0;
      const r1 = 140, r2 = major ? 125 : 132;
      const l = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      l.setAttribute('x1', CLOCK_CX + r1 * Math.cos(a));
      l.setAttribute('y1', CLOCK_CY + r1 * Math.sin(a));
      l.setAttribute('x2', CLOCK_CX + r2 * Math.cos(a));
      l.setAttribute('y2', CLOCK_CY + r2 * Math.sin(a));
      l.setAttribute('class', major ? 'tick-major' : 'tick-minor');
      tG.appendChild(l);
      if (major) {
        const num = i / 5 || 12;
        const t = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        t.setAttribute('x', CLOCK_CX + 111 * Math.cos(a));
        t.setAttribute('y', CLOCK_CY + 111 * Math.sin(a));
        t.setAttribute('class', 'hour-num');
        t.style.fontFamily = fontFamily;
        t.textContent = num;
        nG.appendChild(t);
      }
    }
  } else {
    for (let i = 0; i < 48; i++) {
      const a = (i * 7.5 - 90) * Math.PI / 180;
      const isHour = i % 2 === 0;
      const hourNum = i / 2;
      const isQuarter = hourNum % 6 === 0;
      const r1 = 140;
      const r2 = isHour ? (isQuarter ? 121 : 127) : 134;
      const l = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      l.setAttribute('x1', CLOCK_CX + r1 * Math.cos(a));
      l.setAttribute('y1', CLOCK_CY + r1 * Math.sin(a));
      l.setAttribute('x2', CLOCK_CX + r2 * Math.cos(a));
      l.setAttribute('y2', CLOCK_CY + r2 * Math.sin(a));
      l.setAttribute('class', isHour ? 'tick-major' : 'tick-minor');
      tG.appendChild(l);

      if (isHour && hourNum % 2 === 0) {
        const t = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        t.setAttribute('x', CLOCK_CX + 107 * Math.cos(a));
        t.setAttribute('y', CLOCK_CY + 107 * Math.sin(a));
        const isQ = hourNum % 6 === 0;
        t.setAttribute('class', 'hour-num-24' + (isQ ? ' quarter' : ''));
        t.style.fontFamily = fontFamily;
        t.textContent = hourNum;
        nG.appendChild(t);
      }
    }
  }
}

function setHand(el, deg) {
  const rad = (deg - 90) * Math.PI / 180;
  if (!el._len) {
    el._len = Math.hypot(+el.getAttribute('x2') - CLOCK_CX, +el.getAttribute('y2') - CLOCK_CY);
    el._back = Math.hypot(+el.getAttribute('x1') - CLOCK_CX, +el.getAttribute('y1') - CLOCK_CY);
  }
  el.setAttribute('x2', CLOCK_CX + el._len * Math.cos(rad));
  el.setAttribute('y2', CLOCK_CY + el._len * Math.sin(rad));
  el.setAttribute('x1', CLOCK_CX - el._back * Math.cos(rad));
  el.setAttribute('y1', CLOCK_CY - el._back * Math.sin(rad));
}

const hH = $('#hand-h'), mH = $('#hand-m'), sH = $('#hand-s');
const mainTime = $('#main-time'), mainDate = $('#main-date'), mainTz = $('#main-tz');
const dayNamesShort = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
const monthNamesShort = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
let lastClockSec = -1;

function clockTick() {
  const n = new Date();
  const h = n.getHours(), m = n.getMinutes(), s = n.getSeconds(), ms = n.getMilliseconds();

  setHand(sH, (s + ms / 1000) * 6);
  setHand(mH, m * 6 + s * 0.1);
  setHand(hH, is24h ? (h * 15 + m * 0.25) : ((h % 12) * 30 + m * 0.5));

  const blink = ms < 500 ? '' : ' dim';
  if (is24h) {
    mainTime.innerHTML = `${String(h).padStart(2,'0')}<span class="colon${blink}">:</span>${String(m).padStart(2,'0')}<span class="sec">${String(s).padStart(2,'0')}</span>`;
  } else {
    const h12 = h % 12 || 12;
    mainTime.innerHTML = `${h12}<span class="colon${blink}">:</span>${String(m).padStart(2,'0')}<span class="sec">${String(s).padStart(2,'0')}</span><span class="period">${h<12?'AM':'PM'}</span>`;
  }

  if (s !== lastClockSec) {
    lastClockSec = s;
    mainDate.textContent = `${dayNamesShort[n.getDay()]}  \u00B7  ${monthNamesShort[n.getMonth()]} ${n.getDate()}, ${n.getFullYear()}`;
    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || '';
    const abbr = n.toLocaleTimeString('en-US', { timeZoneName: 'short' }).split(' ').pop();
    mainTz.textContent = `${tz} (${abbr})`;
  }
}

// =====================================================================
//  YEAR VIEW
// =====================================================================
const YEAR_CX = 200, YEAR_CY = 200, YEAR_R = 155;

const monthNamesFull = ['January','February','March','April','May','June','July','August','September','October','November','December'];
const dayNamesFull = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];

function isLeapYear(y) { return (y % 4 === 0 && y % 100 !== 0) || y % 400 === 0; }
function daysInYear(y) { return isLeapYear(y) ? 366 : 365; }

function dayOfYear(d) {
  const start = new Date(d.getFullYear(), 0, 0);
  return Math.floor((d - start) / 86400000);
}

function yearProgress(d) {
  const doy = dayOfYear(d);
  const total = daysInYear(d.getFullYear());
  const h = d.getHours(), m = d.getMinutes(), s = d.getSeconds();
  return (doy - 1 + (h * 3600 + m * 60 + s) / 86400) / total;
}

function getMonthAngles(year) {
  const total = daysInYear(year);
  const daysInMonth = [31, isLeapYear(year) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
  const angles = [];
  let cumDays = 0;
  for (let i = 0; i < 12; i++) {
    angles.push((cumDays / total) * 360 - 90);
    cumDays += daysInMonth[i];
  }
  return { angles, daysInMonth, total };
}

function getSeasonMarkers(year) {
  return [
    { name: 'V.EQ', doy: 80 },
    { name: 'S.SOL', doy: 172 },
    { name: 'A.EQ', doy: 266 },
    { name: 'W.SOL', doy: 355 },
  ];
}

function polarToXY(angle, radius) {
  const rad = angle * Math.PI / 180;
  return { x: YEAR_CX + radius * Math.cos(rad), y: YEAR_CY + radius * Math.sin(rad) };
}

function describeArc(cx, cy, r, startAngle, endAngle) {
  const start = polarToXY(startAngle, r);
  const end = polarToXY(endAngle, r);
  const largeArc = (endAngle - startAngle) > 180 ? 1 : 0;
  return `M ${start.x} ${start.y} A ${r} ${r} 0 ${largeArc} 1 ${end.x} ${end.y}`;
}

// Daylight model
let userLat = 40;

function solarDeclination(doy) {
  return 23.45 * Math.sin((2 * Math.PI / 365) * (doy - 81));
}

function daylightHours(doy, lat) {
  const decl = solarDeclination(doy);
  const latRad = lat * Math.PI / 180;
  const declRad = decl * Math.PI / 180;
  const cosHA = -Math.tan(latRad) * Math.tan(declRad);
  if (cosHA < -1) return 24;
  if (cosHA > 1) return 0;
  return (2 / 15) * (Math.acos(cosHA) * 180 / Math.PI);
}

function computeDaylightData(year) {
  const total = daysInYear(year);
  const data = [];
  let min = 24, max = 0;
  for (let d = 1; d <= total; d++) {
    const h = daylightHours(d, userLat);
    data.push(h);
    if (h < min) min = h;
    if (h > max) max = h;
  }
  return { data, min, max };
}

function daylightColor(normalized, isDarkMode) {
  const r1 = isDarkMode ? 60 : 80,  g1 = isDarkMode ? 100 : 120, b1 = isDarkMode ? 180 : 180;
  const r2 = isDarkMode ? 240 : 200, g2 = isDarkMode ? 180 : 140, b2 = isDarkMode ? 50 : 30;
  const t = normalized;
  const r = Math.round(r1 + (r2 - r1) * t);
  const g = Math.round(g1 + (g2 - g1) * t);
  const b = Math.round(b1 + (b2 - b1) * t);
  return `rgb(${r},${g},${b})`;
}

function buildDaylightBars(year, total) {
  const barG = document.getElementById('daylight-bars');
  barG.innerHTML = '';
  const { data, min, max } = computeDaylightData(year);
  const range = max - min || 1;
  const todayDoy = dayOfYear(new Date());
  const outerR = YEAR_R - 12;
  const maxBarLen = 38;
  const minBarLen = 6;

  for (let d = 0; d < total; d++) {
    const angle = ((d / total) * 360 - 90);
    const norm = (data[d] - min) / range;
    const barLen = minBarLen + (maxBarLen - minBarLen) * norm;
    const p1 = polarToXY(angle, outerR);
    const p2 = polarToXY(angle, outerR - barLen);
    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    line.setAttribute('x1', p1.x);
    line.setAttribute('y1', p1.y);
    line.setAttribute('x2', p2.x);
    line.setAttribute('y2', p2.y);
    line.setAttribute('stroke', daylightColor(norm, isDark));
    line.setAttribute('stroke-width', total <= 365 ? '1.1' : '1');
    line.setAttribute('class', 'daylight-bar' + ((d + 1) < todayDoy ? ' past' : ''));
    barG.appendChild(line);
  }
}

if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(
    pos => { userLat = pos.coords.latitude; if (currentView === 'year') buildRing(); },
    () => {}
  );
}

function buildRing() {
  const now = new Date();
  const year = now.getFullYear();
  const { angles, daysInMonth, total } = getMonthAngles(year);
  const fontFamily = themes[currentStyle][isDark ? 'dark' : 'light'].font;

  // Season arcs
  const seasonG = document.getElementById('seasons');
  seasonG.innerHTML = '';
  const markers = getSeasonMarkers(year);
  const seasonColors = { spring: '#44cc66', summer: '#ffaa22', autumn: '#dd5533', winter: '#4488dd' };
  const seasonRanges = [
    { season: 'winter', start: 0, end: markers[0].doy },
    { season: 'spring', start: markers[0].doy, end: markers[1].doy },
    { season: 'summer', start: markers[1].doy, end: markers[2].doy },
    { season: 'autumn', start: markers[2].doy, end: markers[3].doy },
    { season: 'winter', start: markers[3].doy, end: total },
  ];
  seasonRanges.forEach(sr => {
    const a1 = (sr.start / total) * 360 - 90;
    const a2 = (sr.end / total) * 360 - 90;
    if (a2 > a1) {
      const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      path.setAttribute('d', describeArc(YEAR_CX, YEAR_CY, YEAR_R, a1, a2));
      path.setAttribute('class', 'season-arc');
      path.style.stroke = seasonColors[sr.season];
      seasonG.appendChild(path);
    }
  });

  // Daylight bars
  buildDaylightBars(year, total);

  // Ticks
  const tickG = document.getElementById('year-ticks');
  tickG.innerHTML = '';
  angles.forEach(a => {
    const p1 = polarToXY(a, YEAR_R + 11);
    const p2 = polarToXY(a, YEAR_R - 11);
    const l = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    l.setAttribute('x1', p1.x); l.setAttribute('y1', p1.y);
    l.setAttribute('x2', p2.x); l.setAttribute('y2', p2.y);
    l.setAttribute('class', 'month-tick');
    tickG.appendChild(l);
  });

  for (let d = 7; d < total; d += 7) {
    const a = (d / total) * 360 - 90;
    const closeToMonth = angles.some(ma => Math.abs(a - ma) < 2 || Math.abs(a - ma) > 358);
    if (closeToMonth) continue;
    const p1 = polarToXY(a, YEAR_R + 6);
    const p2 = polarToXY(a, YEAR_R - 6);
    const l = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    l.setAttribute('x1', p1.x); l.setAttribute('y1', p1.y);
    l.setAttribute('x2', p2.x); l.setAttribute('y2', p2.y);
    l.setAttribute('class', 'week-tick');
    tickG.appendChild(l);
  }

  // Month labels
  const labelG = document.getElementById('labels');
  labelG.innerHTML = '';
  const currentMonth = now.getMonth();
  angles.forEach((a, i) => {
    let midAngle;
    if (i < 11) {
      midAngle = (a + angles[i + 1]) / 2;
    } else {
      midAngle = (a + 270) / 2;
    }
    const p = polarToXY(midAngle, YEAR_R - 26);
    const t = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    t.setAttribute('x', p.x);
    t.setAttribute('y', p.y);
    t.setAttribute('class', 'month-label' + (i === currentMonth ? ' current-month' : ''));
    t.style.fontFamily = fontFamily;
    t.textContent = monthNamesShort[i];
    labelG.appendChild(t);
  });

  // Solstice/equinox markers
  const markerG = document.getElementById('markers');
  markerG.innerHTML = '';
  markers.forEach(mk => {
    const a = (mk.doy / total) * 360 - 90;
    const pDot = polarToXY(a, YEAR_R + 18);
    const pLabel = polarToXY(a, YEAR_R + 28);
    const dot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    dot.setAttribute('cx', pDot.x);
    dot.setAttribute('cy', pDot.y);
    dot.setAttribute('r', 2);
    dot.setAttribute('class', 'marker-dot');
    markerG.appendChild(dot);
    const txt = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    txt.setAttribute('x', pLabel.x);
    txt.setAttribute('y', pLabel.y);
    txt.setAttribute('class', 'marker-label');
    txt.style.fontFamily = fontFamily;
    txt.textContent = mk.name;
    markerG.appendChild(txt);
  });

  document.getElementById('center-year').textContent = year;
  document.getElementById('center-year').style.fontFamily = fontFamily;
}

// Year animation
const handEl = document.getElementById('year-hand');
const dotHalo = document.getElementById('dot-halo');
const dotMain = document.getElementById('dot-main');
const trailArc = document.getElementById('trail-arc');

function getCurrentSeason(doy) {
  const markers = getSeasonMarkers(new Date().getFullYear());
  if (doy < markers[0].doy) return 'Winter';
  if (doy < markers[1].doy) return 'Spring';
  if (doy < markers[2].doy) return 'Summer';
  if (doy < markers[3].doy) return 'Autumn';
  return 'Winter';
}

let lastYearSec = -1;

function yearTick() {
  const now = new Date();
  const pct = yearProgress(now);
  const angle = pct * 360 - 90;

  const tip = polarToXY(angle, YEAR_R);
  const tail = polarToXY(angle, 30);
  handEl.setAttribute('x1', tail.x);
  handEl.setAttribute('y1', tail.y);
  handEl.setAttribute('x2', tip.x);
  handEl.setAttribute('y2', tip.y);

  const dp = polarToXY(angle, YEAR_R);
  dotHalo.setAttribute('cx', dp.x);
  dotHalo.setAttribute('cy', dp.y);
  dotMain.setAttribute('cx', dp.x);
  dotMain.setAttribute('cy', dp.y);

  const startAngle = -90;
  if (angle > startAngle) {
    trailArc.setAttribute('d', describeArc(YEAR_CX, YEAR_CY, YEAR_R, startAngle, angle));
  }

  const pulseScale = 1 + 0.3 * Math.sin(Date.now() / 800);
  dotHalo.setAttribute('r', 10 * pulseScale);
  dotHalo.setAttribute('opacity', 0.15 * (1.1 - 0.3 * Math.sin(Date.now() / 800)));

  const sec = now.getSeconds();
  if (sec !== lastYearSec) {
    lastYearSec = sec;
    const doy = dayOfYear(now);
    const total = daysInYear(now.getFullYear());
    const remain = total - doy;

    $('#stat-pct').innerHTML = `${(pct * 100).toFixed(1)}<span class="unit">%</span>`;
    $('#stat-day').textContent = doy;
    $('#stat-remain').textContent = remain;
    $('#date-line').textContent = `${dayNamesFull[now.getDay()]}  \u00B7  ${monthNamesFull[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`;

    const todayLight = daylightHours(doy, userLat);
    const lightH = Math.floor(todayLight);
    const lightM = Math.round((todayLight - lightH) * 60);
    $('#stat-light').innerHTML = `${lightH}<span class="unit">h</span>${String(lightM).padStart(2,'0')}<span class="unit">m</span>`;

    const season = getCurrentSeason(doy);
    const gaining = (doy > 355 || doy < 172);
    const lightTrend = gaining ? 'gaining light' : 'losing light';
    $('#season-line').textContent = `${season}  \u2014  ${lightTrend}`;
  }
}

// =====================================================================
//  ANIMATION LOOP
// =====================================================================
function tick() {
  if (currentView === 'clock') {
    clockTick();
  } else {
    yearTick();
  }
  requestAnimationFrame(tick);
}

// ===== INIT =====
applyTheme();
buildClockFace(true);
requestAnimationFrame(tick);
</script>
</body>
</html>
